# Roadmap: MechInMinutes - Автоматический загрузчик длинных видео с YouTube

## Описание проекта
Автоматический загрузчик длинных видео с YouTube, который:
- Скачивает длинные видео с YouTube
- Нарезает их на короткие части по 59 секунд с перекрытием 2 секунды
- Переформатирует с горизонтального в вертикальный формат
- Накладывает видео на видео для перекрытия черного фона
- Загружает готовые части на YouTube с названием исходного видео + номер части

## Пошаговый план выполнения

### Этап 1: Анализ и подготовка
- [x] Изучить структуру клонированного проекта tiktok-to-youtube-automation
- [x] Проанализировать существующий код для YouTube API
- [x] Определить необходимые библиотеки для работы с видео (ffmpeg-python, moviepy)
- [x] Создать новую структуру проекта для работы с длинными видео

### Этап 2: Настройка окружения
- [x] Создать requirements.txt с необходимыми зависимостями
- [x] Настроить YouTube Data API v3 для загрузки и скачивания
- [x] Создать конфигурационные файлы
- [x] Настроить систему логирования

### Этап 3: Модуль скачивания длинных видео
- [x] Создать youtube_downloader.py для скачивания длинных видео
- [x] Реализовать функцию получения метаданных видео (название, длительность, описание)
- [x] Добавить валидацию URL и проверку доступности видео
- [x] Реализовать скачивание в максимальном качестве

### Этап 4: Модуль нарезки видео
- [x] Создать video_processor.py для обработки видео
- [x] Реализовать функцию нарезки на части по 59 секунд с перекрытием 2 секунды
- [x] Добавить проверку длительности исходного видео
- [x] Реализовать сохранение временных файлов

### Этап 5: Модуль конвертации в вертикальный формат
- [x] Реализовать функцию поворота видео на 90 градусов
- [x] Добавить функцию изменения размера под вертикальный формат (9:16)
- [x] Реализовать добавление черных полос для заполнения фона
- [x] Создать функцию центрирования контента

### Этап 6: Модуль наложения видео
- [x] Реализовать функцию масштабирования первого видео (увеличение)
- [x] Создать функцию наложения второго видео поверх первого
- [x] Реализовать алгоритм позиционирования для оптимального перекрытия
- [x] Добавить настройки прозрачности и смешивания

### Этап 7: Модуль загрузки на YouTube
- [x] Адаптировать существующий youtube_uploader.py для коротких видео
- [x] Реализовать генерацию названий: "Название исходного видео - Часть X"
- [x] Добавить автоматическое создание описаний с номерами частей
- [x] Реализовать загрузку с тегами и категориями

### Этап 8: Основной модуль координации
- [x] Создать main_processor.py как главный модуль
- [x] Реализовать последовательность: скачивание → нарезка → конвертация → наложение → загрузка
- [x] Добавить обработку ошибок на каждом этапе
- [x] Реализовать прогресс-бар и уведомления

### Этап 9: Конфигурация и настройки
- [x] Создать config.py с настройками:
  - Длительность сегментов (59 сек)
  - Перекрытие (2 сек)
  - Размеры выходного видео
  - Качество сжатия
- [x] Добавить возможность изменения параметров через файл конфигурации

### Этап 10: Обработка метаданных
- [x] Реализовать извлечение названия, описания, тегов из исходного видео
- [x] Создать функцию генерации описаний для каждой части
- [x] Добавить информацию о номере части в метаданные
- [x] Реализовать сохранение информации о процессе обработки

### Этап 11: Оптимизация и производительность
- [x] Оптимизировать использование памяти при обработке больших видео
- [x] Реализовать параллельную обработку сегментов
- [x] Добавить кэширование промежуточных результатов
- [x] Оптимизировать размеры выходных файлов

### Этап 12: Обработка ошибок и восстановление
- [x] Реализовать систему повторных попыток для загрузки
- [x] Добавить восстановление после сбоев на любом этапе
- [x] Создать систему логирования всех операций
- [x] Реализовать уведомления об ошибках

### Этап 13: Пользовательский интерфейс
- [x] Создать простой CLI интерфейс для ввода URL
- [x] Добавить интерактивные настройки параметров
- [x] Реализовать предварительный просмотр настроек
- [x] Создать систему подтверждения перед началом обработки

### Этап 14: Финальная интеграция
- [x] Объединить все модули в единую систему
- [x] Протестировать полный цикл обработки
- [x] Оптимизировать производительность
- [x] Создать документацию по использованию

### Этап 15: Дополнительные возможности
- [x] Добавить поддержку плейлистов YouTube
- [x] Реализовать фильтрацию по длительности видео
- [x] Добавить возможность выбора качества исходного видео
- [x] Создать систему шаблонов для названий и описаний

### Этап 16: Обход канала и выбор видео
- [x] Получать список видео канала по handle (`@RestorationSkills777`) через YouTube Data API/yt-dlp
- [x] Начинать обработку с первого видео на вкладке «Видео» (самого нового)
- [x] Поддержать постраничную загрузку/пагинацию всех видео канала
- [x] Хранить состояние обработанных `videoId` (локальная БД/CSV) для возобновления

### Этап 17: Качество скачивания 720p
- [x] Скачивать видео в «не выше 720p» (правило `best[height<=720]`/эквивалент для yt-dlp)
- [x] Падать обратно на ближайшее доступное качество, если 720p недоступно
- [x] Фиксировать итоговое разрешение входного файла в метаданных пайплайна

### Этап 18: Бесконечный цикл обработки и ожидания
- [x] Основной цикл: берём следующее не обработанное видео → нарезаем → загружаем все части
- [x] После полного завершения по каналу: спим 24 часа, затем проверяем новые видео
- [x] При отсутствии новых видео: снова спим 24 часа (до появления)
- [x] Конфигурировать период ожидания (по умолчанию 24 часа)

### Этап 19: Обработка квот YouTube и дневных лимитов
- [x] Ловить `quotaExceeded` и дневные лимиты на загрузку/публикацию
- [x] При срабатывании лимитов: засыпать на 24 часа и возобновлять с места остановки
- [x] Идempotentность: не дублировать уже загруженные части

### Этап 20: Граничные случаи нарезки последнего сегмента
- [x] Не создавать последний клип, если его длина < 3 секунд
- [x] Если длительность исходного видео < 59 сек: создавать один клип, только если ≥ 3 сек
- [x] Исключить зацикливание на последнем коротком сегменте (строгая проверка прогресса `start`/`end`)
- [x] Корректная обработка аудио/видео потоков при коротких клипах

### Этап 21: План загрузки по частям
- [x] Имена: «Название исходного видео — Часть N» (локализация RU)
- [x] Описание: ссылка на исходное видео, счётчик «Часть N из M»
- [x] Теги и категория для Shorts
- [x] Лог действий и результатов загрузки (включая `videoId` YouTube)

## Технические требования

### Необходимые библиотеки:
- `youtube-dl` или `yt-dlp` - для скачивания видео
- `moviepy` - для обработки видео
- `ffmpeg-python` - для работы с ffmpeg
- `google-api-python-client` - для YouTube API
- `google-auth-oauthlib` - для аутентификации

### Системные требования:
- Python 3.8+
- FFmpeg установленный в системе
- Достаточно места на диске для временных файлов
- Стабильное интернет-соединение

## Ожидаемый результат
Полностью автоматизированная система, которая принимает URL длинного видео с YouTube и создает серию коротких вертикальных видео с наложением, готовых для загрузки на YouTube Shorts.
